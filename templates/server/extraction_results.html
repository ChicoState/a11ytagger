{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>Accessibility Analysis Results</h1>
    <p class="filename"><strong>File:</strong> {{ result.pdf_filename }} ({{ result.page_count }} pages, {{ result.file_size_bytes|filesizeformat }})</p>

    {% if result.errors %}
    <div class="error-message" style="background-color: #fee; border: 1px solid #c33; padding: 1rem; margin: 1rem 0; border-radius: 4px;">
        <strong>Errors:</strong>
        <ul>
            {% for error in result.errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if result.warnings %}
    <div class="warning-message" style="background-color: #ffc; border: 1px solid #cc6; padding: 1rem; margin: 1rem 0; border-radius: 4px;">
        <strong>Warnings:</strong>
        <ul>
            {% for warning in result.warnings %}
            <li>{{ warning }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <div class="view-toggle" style="margin: 2rem 0;">
        <button data-view="simple" class="active" style="padding: 0.5rem 1rem; margin-right: 0.5rem;">Simple View</button>
        <button data-view="detailed" style="padding: 0.5rem 1rem;">Detailed View</button>
    </div>

    <div class="simple-view">
        <div class="summary-section" style="background-color: #f9f9f9; border: 1px solid #ddd; padding: 1.5rem; margin: 1rem 0; border-radius: 4px;">
            <h2>Summary</h2>
            
            <div class="summary-stats">
                <div class="stat" style="margin: 0.5rem 0;">
                    <strong>Total Images:</strong> {{ result.total_images }}
                </div>
                <div class="stat" style="margin: 0.5rem 0;">
                    <strong>Images with Alt Text:</strong> {{ result.images_with_alt_text }} / {{ result.total_images }}
                    {% if result.images_without_alt_text > 0 %}
                    <span style="color: #c33; font-weight: bold;">({{ result.images_without_alt_text }} missing)</span>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="structure-section" style="background-color: #f9f9f9; border: 1px solid #ddd; padding: 1.5rem; margin: 1rem 0; border-radius: 4px;">
            <h2>Document Structure</h2>
            
            <div class="structure-stats">
                <div class="stat" style="margin: 0.5rem 0;">
                    <strong>Has Structure Tags:</strong> 
                    {% if result.has_structure_tree %}
                    <span style="color: #393; font-weight: bold;">Yes</span>
                    {% else %}
                    <span style="color: #c33; font-weight: bold;">No</span>
                    {% endif %}
                </div>
                <div class="stat" style="margin: 0.5rem 0;">
                    <strong>Tagged PDF:</strong> 
                    {% if result.is_tagged %}
                    <span style="color: #393; font-weight: bold;">Yes</span>
                    {% else %}
                    <span style="color: #c33; font-weight: bold;">No</span>
                    {% endif %}
                </div>
                {% if result.structure_types_found %}
                <div class="stat" style="margin: 0.5rem 0;">
                    <strong>Structure Types Found:</strong> {{ result.structure_types_found|join:", " }}
                </div>
                {% endif %}
                {% if result.max_heading_level %}
                <div class="stat" style="margin: 0.5rem 0;">
                    <strong>Highest Heading Level:</strong> H{{ result.max_heading_level }}
                </div>
                {% endif %}
            </div>
        </div>

        <div class="metadata-section" style="background-color: #f9f9f9; border: 1px solid #ddd; padding: 1.5rem; margin: 1rem 0; border-radius: 4px;">
            <h2>Document Metadata</h2>
            
            <div class="metadata-stats">
                {% if result.document_title %}
                <div class="stat" style="margin: 0.5rem 0;">
                    <strong>Title:</strong> {{ result.document_title }}
                </div>
                {% endif %}
                {% if result.document_language %}
                <div class="stat" style="margin: 0.5rem 0;">
                    <strong>Language:</strong> {{ result.document_language }}
                </div>
                {% endif %}
                <div class="stat" style="margin: 0.5rem 0;">
                    <strong>PDF Version:</strong> {{ result.pdf_version }}
                </div>
            </div>
        </div>
    </div>

    <div class="detailed-view" style="display: none;">
        <!-- Detailed view content will be added in User Story 2 -->
    </div>

    <div style="margin: 2rem 0;">
        <a href="{% url 'pdf_accessibility_upload' %}" style="padding: 0.5rem 1rem; background-color: #007bff; color: white; text-decoration: none; border-radius: 4px;">Analyze Another PDF</a>
    </div>
</div>

<script>
document.querySelectorAll('.view-toggle button').forEach(button => {
    button.addEventListener('click', function() {
        document.querySelectorAll('.view-toggle button').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        const view = this.dataset.view;
        document.querySelector('.simple-view').style.display = view === 'simple' ? 'block' : 'none';
        document.querySelector('.detailed-view').style.display = view === 'detailed' ? 'block' : 'none';
    });
});
</script>
{% endblock %}
